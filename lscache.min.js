!function(a,b){"function"==typeof define&&define.amd?define([],b):"undefined"!=typeof module&&module.exports?module.exports=b():a.lscache=b()}(this,function(){function a(){var a="__lscachetest__",c=a;if(void 0!==j)return j;try{g(a,c),h(a),j=!0}catch(d){j=b(d)?!0:!1}return j}function b(a){return a&&"QUOTA_EXCEEDED_ERR"===a.name||"NS_ERROR_DOM_QUOTA_REACHED"===a.name||"QuotaExceededError"===a.name?!0:!1}function c(){return void 0===k&&(k=null!=window.JSON),k}function d(a){return a+m}function e(){return Math.floor((new Date).getTime()/o)}function f(a){return localStorage.getItem(l+q+a)}function g(a,b){localStorage.removeItem(l+q+a),localStorage.setItem(l+q+a,b)}function h(a){localStorage.removeItem(l+q+a)}function i(a,b){r&&"console"in window&&"function"==typeof window.console.warn&&(window.console.warn("lscache - "+a),b&&window.console.warn("lscache - The error was: "+b.message))}var j,k,l="lscache-",m="-cacheexpiration",n=10,o=6e4,p=Math.floor(864e13/o),q="",r=!1,s={set:function(j,k,o){if(a()){if("string"!=typeof k){if(!c())return;try{k=JSON.stringify(k)}catch(r){return}}try{g(j,k)}catch(r){if(!b(r))return void i("Could not add item with key '"+j+"'",r);for(var s,t=[],u=0;u<localStorage.length;u++)if(s=localStorage.key(u),0===s.indexOf(l+q)&&s.indexOf(m)<0){var v=s.substr((l+q).length),w=d(v),x=f(w);x=x?parseInt(x,n):p,t.push({key:v,size:(f(v)||"").length,expiration:x})}t.sort(function(a,b){return b.expiration-a.expiration});for(var y=(k||"").length;t.length&&y>0;)s=t.pop(),i("Cache is full, removing item with key '"+j+"'"),h(s.key),h(d(s.key)),y-=s.size;try{g(j,k)}catch(r){return void i("Could not add item with key '"+j+"', perhaps it's too big?",r)}}o?g(d(j),(e()+o).toString(n)):h(d(j))}},get:function(b){if(!a())return null;var g=d(b),i=f(g);if(i){var j=parseInt(i,n);if(e()>=j)return h(b),h(g),null}var k=f(b);if(!k||!c())return k;try{return JSON.parse(k)}catch(l){return k}},fetch:function(a,b){var c=this.get(a),d=b;return c?c:(b instanceof Function&&(d=b()),this.set(a,d),d)},remove:function(b){return a()?(h(b),void h(d(b))):null},supported:function(){return a()},flush:function(){if(a())for(var b=localStorage.length-1;b>=0;--b){var c=localStorage.key(b);0===c.indexOf(l+q)&&localStorage.removeItem(c)}},setBucket:function(a){q=a},resetBucket:function(){q=""},enableWarnings:function(a){r=a}};return s});