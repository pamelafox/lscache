!function(a,b){"function"==typeof define&&define.amd?define([],b):"undefined"!=typeof module&&module.exports?module.exports=b():a.lscache=b()}(this,function(){function a(){var a="__lscachetest__",c=a;if(void 0!==n)return n;try{g(a,c),i(a),n=!0}catch(d){n=b(d)?!0:!1}return n}function b(a){return a&&"QUOTA_EXCEEDED_ERR"===a.name||"NS_ERROR_DOM_QUOTA_REACHED"===a.name||"QuotaExceededError"===a.name?!0:!1}function c(){return void 0===o&&(o=null!=window.JSON),o}function d(a){return a+r}function e(){return Math.floor((new Date).getTime()/t)}function f(a){return localStorage.getItem(p+v+a)}function g(a,b){localStorage.removeItem(p+v+a),localStorage.setItem(p+v+a,b),h(a)}function h(a){var b=q+p+v+a;localStorage.setItem(b,"1"===localStorage.getItem(b)?"0":"1")}function i(a){localStorage.removeItem(p+v+a),localStorage.removeItem(q+p+v+a)}function j(a){for(var b=new RegExp("^"+p+v+"(.*)"),c=localStorage.length-1;c>=0;--c){var e=localStorage.key(c);e=e&&e.match(b),e=e&&e[1],e&&e.indexOf(r)<0&&a(e,d(e))}}function k(a){var b=d(a);i(a),i(b)}function l(a){var b=d(a),c=f(b);if(c){var g=parseInt(c,s);if(e()>=g)return i(a),i(b),!0}}function m(a,b){w&&"console"in window&&"function"==typeof window.console.warn&&(window.console.warn("lscache - "+a),b&&window.console.warn("lscache - The error was: "+b.message))}var n,o,p="lscache-",q="lscachechange-",r="-cacheexpiration",s=10,t=6e4,u=Math.floor(864e13/t),v="",w=!1,x={};window.addEventListener("storage",function(a){for(var b,c=x[a.key]||[],d=0;d<c.length;d++)(b=c[d])()},!1);var y={set:function(h,l,n){if(a()){if("string"!=typeof l){if(!c())return;try{l=JSON.stringify(l)}catch(o){return}}try{g(h,l)}catch(o){if(!b(o))return void m("Could not add item with key '"+h+"'",o);var p,q=[];j(function(a,b){var c=f(b);c=c?parseInt(c,s):u,q.push({key:a,size:(f(a)||"").length,expiration:c})}),q.sort(function(a,b){return b.expiration-a.expiration});for(var r=(l||"").length;q.length&&r>0;)p=q.pop(),m("Cache is full, removing item with key '"+h+"'"),k(p.key),r-=p.size;try{g(h,l)}catch(o){return void m("Could not add item with key '"+h+"', perhaps it's too big?",o)}}n?g(d(h),(e()+n).toString(s)):i(d(h))}},get:function(b){if(!a())return null;if(l(b))return null;var d=f(b);if(!d||!c())return d;try{return JSON.parse(d)}catch(e){return d}},watch:function(a,b){var c=q+p+v+a,d=x[c]=x[c]||[];d.push(b)},unwatch:function(a,b){var c=q+p+v+a,d=x[c]=x[c]||[];d.splice(d.indexOf(b))},remove:function(b){a()&&k(b)},supported:function(){return a()},flush:function(){a()&&j(function(a){k(a)})},flushExpired:function(){a()&&j(function(a){l(a)})},setBucket:function(a){v=a},resetBucket:function(){v=""},enableWarnings:function(a){w=a}};return y});